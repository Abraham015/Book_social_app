import './polyfills.server.mjs';
import{c as Se}from"./chunk-E64U5GZN.mjs";import{b as N,c as j,f as B,i as W,j as Ie,k as A,l as Fe,m as Me,n as L,o as $,p as Ee}from"./chunk-JVTTK432.mjs";import{$ as me,Da as Ce,J as l,Ja as T,K as m,Ka as O,La as ve,P as h,Q as ue,R as d,S as de,T as s,Ta as P,U as a,Ua as _e,V as _,Wa as be,Xa as ye,Y as M,Ya as Ae,Z as f,_ as u,aa as fe,ba as ge,bb as xe,c as C,ca as ee,cb as Re,da as c,e as F,ea as E,eb as we,ga as R,gb as H,h as re,ha as S,i as se,ia as w,ib as ke,j as ae,k as Y,ka as k,l as pe,ma as te,n as v,o as ce,r as le,s as b,t as y,ua as he,w as X}from"./chunk-HM557RPL.mjs";import{h as oe}from"./chunk-5XUXGTUW.mjs";var z=class i{title="book-social-ui";static \u0275fac=function(e){return new(e||i)};static \u0275cmp=v({type:i,selectors:[["app-root"]],standalone:!0,features:[k],decls:1,vars:0,template:function(e,t){e&1&&_(0,"router-outlet")},dependencies:[we]})};function K(i,r,e,t){let o=new L(r,K.PATH,"get");return e&&o.query("token",e.token,{}),i.request(o.build({responseType:"json",accept:"application/json",context:t})).pipe(F(n=>n instanceof P),C(n=>n))}K.PATH="/auth/activate-account";function Q(i,r,e,t){let o=new L(r,Q.PATH,"post");return e&&o.body(e.body,"application/json"),i.request(o.build({responseType:"json",accept:"application/json",context:t})).pipe(F(n=>n instanceof P),C(n=>n))}Q.PATH="/auth/authenticate";function U(i,r,e,t){let o=new L(r,U.PATH,"post");return e&&o.body(e.body,"application/json"),i.request(o.build({responseType:"json",accept:"application/json",context:t})).pipe(F(n=>n instanceof P),C(n=>n))}U.PATH="/auth/register";var I=class i extends Me{constructor(r,e){super(r,e)}static RegisterPath="/auth/register";register$Response(r,e){return U(this.http,this.rootUrl,r,e)}register(r,e){return this.register$Response(r,e).pipe(C(t=>t.body))}static AuthenticatePath="/auth/authenticate";authenticate$Response(r,e){return Q(this.http,this.rootUrl,r,e)}authenticate(r,e){return this.authenticate$Response(r,e).pipe(C(t=>t.body))}static ActiveAccountPath="/auth/activate-account";activeAccount$Response(r,e){return K(this.http,this.rootUrl,r,e)}activeAccount(r,e){return this.activeAccount$Response(r,e).pipe(C(t=>t.body))}static \u0275fac=function(e){return new(e||i)(Y(Fe),Y(_e))};static \u0275prov=re({token:i,factory:i.\u0275fac,providedIn:"root"})};function Be(i,r){if(i&1&&(s(0,"p"),c(1),a()),i&2){let e=r.$implicit;l(),E(e)}}function We(i,r){if(i&1&&(s(0,"div",11),h(1,Be,2,1,"p",12),a()),i&2){let e=u();l(),d("ngForOf",e.errorMsg)}}var Z=class i{constructor(r,e,t){this.router=r;this.authService=e;this.tokenService=t}authRequest={email:"",password:""};errorMsg=[];login(){this.errorMsg=[],this.authService.authenticate({body:this.authRequest}).subscribe({next:r=>{this.tokenService.token=r.data,this.router.navigate(["books"])},error:r=>{console.log(r.error.validationErrors),r.error.validationErrors?A.fire({title:"Error!",text:r.error.validationErrors,icon:"error",confirmButtonText:"Ok"}):A.fire({title:"Error!",text:"Email and / or Password is incorrect",icon:"error",confirmButtonText:"Ok"})}})}register(){this.router.navigate(["register"])}static \u0275fac=function(e){return new(e||i)(m(H),m(I),m($))};static \u0275cmp=v({type:i,selectors:[["app-login"]],standalone:!0,features:[k],decls:22,vars:3,consts:[[1,"container-fluid","card","login-container"],[1,"text-center"],["class","alert alert-danger","role","alert",4,"ngIf"],[1,"mb-3"],[1,"form-label"],["type","email","id","login","placeholder","name@example.com",1,"form-control",3,"ngModelChange","ngModel"],["type","password","id","password","placeholder","password",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-between","mb-3"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fas","fa-sign-in-alt"],["type","button",1,"btn","btn-link",3,"click"],["role","alert",1,"alert","alert-danger"],[4,"ngFor","ngForOf"]],template:function(e,t){e&1&&(s(0,"div",0)(1,"h3",1),c(2,"Login"),a(),_(3,"hr"),h(4,We,2,1,"div",2),s(5,"div",3)(6,"label",4),c(7,"Email address"),a(),s(8,"input",5),w("ngModelChange",function(n){return S(t.authRequest.email,n)||(t.authRequest.email=n),n}),a()(),s(9,"div",3)(10,"label",4),c(11,"Password"),a(),s(12,"input",6),w("ngModelChange",function(n){return S(t.authRequest.password,n)||(t.authRequest.password=n),n}),a()(),s(13,"div",7)(14,"button",8),f("click",function(){return t.login()}),_(15,"em",9),c(16," \xA0 Sign in "),a(),s(17,"div"),c(18," Don't have an account? \xA0 "),s(19,"button",10),f("click",function(){return t.register()}),_(20,"em",9),c(21," \xA0 Register "),a()()()()),e&2&&(l(4),d("ngIf",t.errorMsg.length),l(4),R("ngModel",t.authRequest.email),l(4),R("ngModel",t.authRequest.password))},dependencies:[W,N,j,B,O,T]})};function $e(i,r){if(i&1&&(s(0,"p"),c(1),a()),i&2){let e=r.$implicit;l(),E(e)}}function ze(i,r){if(i&1&&(s(0,"div",13),h(1,$e,2,1,"p",14),a()),i&2){let e=u();l(),d("ngForOf",e.errorMsg)}}var G=class i{constructor(r,e){this.router=r;this.authService=e}registerRequest={email:"",firstName:"",lastName:"",password:""};errorMsg=[];login(){this.router.navigate(["login"])}register(){this.errorMsg=[],this.authService.register({body:this.registerRequest}).subscribe({next:()=>{A.fire({icon:"success",title:"User created successfully",confirmButtonText:"Ok"}).then(()=>this.router.navigate(["activate-account"]))},error:r=>{A.fire({title:"Error!",html:`
              ${r.error.validationErrors.join("<br>")}
            `,icon:"error",confirmButtonText:"Ok"})}})}static \u0275fac=function(e){return new(e||i)(m(H),m(I))};static \u0275cmp=v({type:i,selectors:[["app-register"]],standalone:!0,features:[k],decls:30,vars:5,consts:[[1,"container-fluid","card","login-container"],[1,"text-center"],["class","alert alert-danger","role","alert",4,"ngIf"],[1,"mb-3"],[1,"form-label"],["type","email","id","firstname","placeholder","John",1,"form-control",3,"ngModelChange","ngModel"],["type","email","id","lastname","placeholder","John",1,"form-control",3,"ngModelChange","ngModel"],["type","email","id","login","placeholder","name@example.com",1,"form-control",3,"ngModelChange","ngModel"],["type","password","id","password","placeholder","password",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-between","mb-3"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fas","fa-sign-in-alt"],["type","button",1,"btn","btn-link",3,"click"],["role","alert",1,"alert","alert-danger"],[4,"ngFor","ngForOf"]],template:function(e,t){e&1&&(s(0,"div",0)(1,"h3",1),c(2,"Create an account"),a(),_(3,"hr"),h(4,ze,2,1,"div",2),s(5,"div",3)(6,"label",4),c(7,"First Name"),a(),s(8,"input",5),w("ngModelChange",function(n){return S(t.registerRequest.firstName,n)||(t.registerRequest.firstName=n),n}),a()(),s(9,"div",3)(10,"label",4),c(11,"Last Name"),a(),s(12,"input",6),w("ngModelChange",function(n){return S(t.registerRequest.lastName,n)||(t.registerRequest.lastName=n),n}),a()(),s(13,"div",3)(14,"label",4),c(15,"Email address"),a(),s(16,"input",7),w("ngModelChange",function(n){return S(t.registerRequest.email,n)||(t.registerRequest.email=n),n}),a()(),s(17,"div",3)(18,"label",4),c(19,"Password"),a(),s(20,"input",8),w("ngModelChange",function(n){return S(t.registerRequest.password,n)||(t.registerRequest.password=n),n}),a()(),s(21,"div",9)(22,"button",10),f("click",function(){return t.register()}),_(23,"em",11),c(24," \xA0 Register "),a(),s(25,"div"),c(26," Already have an account? \xA0 "),s(27,"button",12),f("click",function(){return t.login()}),_(28,"em",11),c(29," \xA0 Login "),a()()()()),e&2&&(l(4),d("ngIf",t.errorMsg.length),l(4),R("ngModel",t.registerRequest.firstName),l(4),R("ngModel",t.registerRequest.lastName),l(4),R("ngModel",t.registerRequest.email),l(4),R("ngModel",t.registerRequest.password))},dependencies:[T,O,Ie,N,j,W,B]})};var Ke=["input"];function Qe(i,r){if(i&1){let e=M();s(0,"span")(1,"input",2,0),f("click",function(o){b(e);let n=u();return y(n.onClick(o))})("paste",function(o){let n=b(e).index,p=u();return y(p.onPaste(o,n))})("input",function(o){let n=b(e).index,p=u();return y(p.onInput(o,n))})("keydown",function(o){let n=b(e).index,p=u();return y(p.onKeydown(o,n))}),a()()}if(i&2){let e=u();de("code-hidden",e.isCodeHidden),l(),d("type",e.inputType)("disabled",e.disabled),ue("inputmode",e.inputMode)("autocapitalize",e.autocapitalize)}}var Pe=new ae("CodeInputComponentConfig"),Oe={codeLength:4,inputType:"tel",inputMode:"numeric",initialFocusField:void 0,isCharsCode:!1,isCodeHidden:!1,isPrevFocusableAfterClearing:!0,isFocusingOnLastByClickIfFilled:!1,code:void 0,disabled:!1,autocapitalize:void 0},V=function(i){return i[i.ready=0]="ready",i[i.reset=1]="reset",i}(V||{}),He=(()=>{class i{constructor(e){if(this.isNonDigitsCode=!1,this.codeChanged=new X,this.codeCompleted=new X,this.placeholders=[],this.inputs=[],this.inputsStates=[],this.state={isFocusingAfterAppearingCompleted:!1,isInitialFocusFieldEnabled:!1},Object.assign(this,Oe),!!e)for(let t in e)e.hasOwnProperty(t)&&Oe.hasOwnProperty(t)&&(this[t]=e[t])}ngOnInit(){this.state.isInitialFocusFieldEnabled=!this.isEmpty(this.initialFocusField),this.onCodeLengthChanges()}ngAfterViewInit(){this.inputsListSubscription=this.inputsList.changes.subscribe(this.onInputsListChanges.bind(this)),this.onInputsListChanges(this.inputsList)}ngAfterViewChecked(){this.focusOnInputAfterAppearing()}ngOnChanges(e){e.code&&this.onInputCodeChanges(),e.codeLength&&this.onCodeLengthChanges()}ngOnDestroy(){this.inputsListSubscription&&this.inputsListSubscription.unsubscribe()}reset(e=!1){this.onInputCodeChanges(),this.state.isInitialFocusFieldEnabled&&this.focusOnField(this.initialFocusField),e&&this.emitChanges()}focusOnField(e){if(e>=this._codeLength)throw new Error("The index of the focusing input box should be less than the codeLength.");this.inputs[e].focus()}onClick(e){if(!this.isFocusingOnLastByClickIfFilled)return;let t=e.target,o=this.inputs[this._codeLength-1];t===o||!(this.getCurrentFilledCode().length>=this._codeLength)||setTimeout(()=>o.focus())}onInput(e,t){let o=e.target,n=e.data||o.value;if(this.isEmpty(n))return;if(!this.canInputValue(n)){e.preventDefault(),e.stopPropagation(),this.setInputValue(o,null),this.setStateForInput(o,V.reset);return}let p=n.toString().trim().split("");for(let g=0;g<p.length;g++){let q=g+t;if(q>this._codeLength-1)break;this.setInputValue(this.inputs[q],p[g])}this.emitChanges();let x=t+p.length;if(x>this._codeLength-1){o.blur();return}this.inputs[x].focus()}onPaste(e,t){e.preventDefault(),e.stopPropagation();let o=e.clipboardData?e.clipboardData.getData("text").trim():void 0;if(this.isEmpty(o))return;let n=o.split(""),p=0;for(let x=t;x<this.inputs.length&&p!==n.length;x++){let g=this.inputs[x],q=n[p];if(!this.canInputValue(q)){this.setInputValue(g,null),this.setStateForInput(g,V.reset);return}this.setInputValue(g,q.toString()),p++}this.inputs[t].blur(),this.emitChanges()}onKeydown(e,t){return oe(this,null,function*(){let o=e.target,n=this.isEmpty(o.value),p=t-1,x=yield this.isBackspaceKey(e),g=this.isDeleteKey(e);!x&&!g||(e.preventDefault(),this.setInputValue(o,null),n||this.emitChanges(),!(p<0||g)&&(n||this.isPrevFocusableAfterClearing)&&this.inputs[p].focus())})}onInputCodeChanges(){if(!this.inputs.length)return;if(this.isEmpty(this.code)){this.inputs.forEach(o=>{this.setInputValue(o,null)});return}let e=this.code.toString().trim().split(""),t=!0;for(let o of e)if(!this.canInputValue(o)){t=!1;break}this.inputs.forEach((o,n)=>{let p=t?e[n]:null;this.setInputValue(o,p)})}onCodeLengthChanges(){if(this.codeLength)if(this._codeLength=this.codeLength,this._codeLength>this.placeholders.length){let e=Array(this._codeLength-this.placeholders.length).fill(1);this.placeholders.splice(this.placeholders.length-1,0,...e)}else this._codeLength<this.placeholders.length&&this.placeholders.splice(this._codeLength)}onInputsListChanges(e){if(e.length>this.inputs.length){let t=e.filter((n,p)=>p>this.inputs.length-1);this.inputs.splice(this.inputs.length,0,...t.map(n=>n.nativeElement));let o=Array(t.length).fill(V.ready);this.inputsStates.splice(this.inputsStates.length,0,...o)}else e.length<this.inputs.length&&(this.inputs.splice(e.length),this.inputsStates.splice(e.length));this.onInputCodeChanges()}focusOnInputAfterAppearing(){this.state.isInitialFocusFieldEnabled&&(this.state.isFocusingAfterAppearingCompleted||(this.focusOnField(this.initialFocusField),this.state.isFocusingAfterAppearingCompleted=document.activeElement===this.inputs[this.initialFocusField]))}emitChanges(){setTimeout(()=>this.emitCode(),50)}emitCode(){let e=this.getCurrentFilledCode();this.codeChanged.emit(e),e.length>=this._codeLength&&this.codeCompleted.emit(e)}getCurrentFilledCode(){let e="";for(let t of this.inputs)this.isEmpty(t.value)||(e+=t.value);return e}isBackspaceKey(e){return e.key&&e.key.toLowerCase()==="backspace"||e.keyCode&&e.keyCode===8?Promise.resolve(!0):!e.keyCode||e.keyCode!==229?Promise.resolve(!1):new Promise(o=>{setTimeout(()=>{let n=e.target,p=this.getStateForInput(n)===V.reset;p&&this.setStateForInput(n,V.ready),o(n.selectionStart===0&&!p)})})}isDeleteKey(e){return e.key&&e.key.toLowerCase()==="delete"||e.keyCode&&e.keyCode===46}setInputValue(e,t){let o=this.isEmpty(t),n="has-value",p="empty";o?(e.value="",e.classList.remove(n),e.parentElement.classList.add(p)):(e.value=t,e.classList.add(n),e.parentElement.classList.remove(p))}canInputValue(e){return this.isEmpty(e)?!1:/^[0-9]+$/.test(e.toString())||this.isCharsCode||this.isNonDigitsCode}setStateForInput(e,t){let o=this.inputs.indexOf(e);o<0||(this.inputsStates[o]=t)}getStateForInput(e){let t=this.inputs.indexOf(e);return this.inputsStates[t]}isEmpty(e){return e==null||!e.toString().length}static{this.\u0275fac=function(t){return new(t||i)(m(Pe,8))}}static{this.\u0275cmp=v({type:i,selectors:[["code-input"]],viewQuery:function(t,o){if(t&1&&me(Ke,5),t&2){let n;fe(n=ge())&&(o.inputsList=n)}},inputs:{codeLength:"codeLength",inputType:"inputType",inputMode:"inputMode",initialFocusField:"initialFocusField",isNonDigitsCode:"isNonDigitsCode",isCharsCode:"isCharsCode",isCodeHidden:"isCodeHidden",isPrevFocusableAfterClearing:"isPrevFocusableAfterClearing",isFocusingOnLastByClickIfFilled:"isFocusingOnLastByClickIfFilled",code:"code",disabled:"disabled",autocapitalize:"autocapitalize"},outputs:{codeChanged:"codeChanged",codeCompleted:"codeCompleted"},features:[le],decls:1,vars:1,consts:[["input",""],[3,"code-hidden",4,"ngFor","ngForOf"],["autocomplete","one-time-code",3,"click","paste","input","keydown","type","disabled"]],template:function(t,o){t&1&&h(0,Qe,3,6,"span",1),t&2&&d("ngForOf",o.placeholders)},dependencies:[T],styles:["[_nghost-%COMP%]{--text-security-type: disc;--item-spacing: 4px;--item-height: 4.375em;--item-border: 1px solid #dddddd;--item-border-bottom: 1px solid #dddddd;--item-border-has-value: 1px solid #dddddd;--item-border-bottom-has-value: 1px solid #dddddd;--item-border-focused: 1px solid #dddddd;--item-border-bottom-focused: 1px solid #dddddd;--item-shadow-focused: 0px 1px 5px rgba(221, 221, 221, 1);--item-border-radius: 5px;--item-background: transparent;--item-font-weight: 300;--color: #171516;display:flex;transform:translateZ(0);font-size:inherit;color:var(--color)}[_nghost-%COMP%]   span[_ngcontent-%COMP%]{display:block;flex:1;padding-right:var(--item-spacing)}[_nghost-%COMP%]   span[_ngcontent-%COMP%]:first-child{padding-left:var(--item-spacing)}[_nghost-%COMP%]   span.code-hidden[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-security:var(--text-security-type);-webkit-text-security:var(--text-security-type);-moz-text-security:var(--text-security-type)}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{width:100%;height:var(--item-height);color:inherit;background:var(--item-background);text-align:center;font-size:inherit;font-weight:var(--item-font-weight);border:var(--item-border);border-bottom:var(--item-border-bottom);border-radius:var(--item-border-radius);-webkit-appearance:none;transform:translateZ(0);-webkit-transform:translate3d(0,0,0);outline:none}[_nghost-%COMP%]   input.has-value[_ngcontent-%COMP%]{border:var(--item-border-has-value);border-bottom:var(--item-border-bottom-has-value)}[_nghost-%COMP%]   input[_ngcontent-%COMP%]:focus{border:var(--item-border-focused);border-bottom:var(--item-border-bottom-focused);box-shadow:var(--item-shadow-focused)}"]})}}return i})(),Le=(()=>{class i{static forRoot(e){return{ngModule:i,providers:[{provide:Pe,useValue:e}]}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=ce({type:i})}static{this.\u0275inj=se({imports:[ve]})}}return i})();function Ze(i,r){if(i&1){let e=M();s(0,"div",5)(1,"h2"),c(2,"Activation successful!"),a(),s(3,"p"),c(4,"Your account has been successfully activated!"),a(),s(5,"button",6),f("click",function(){b(e);let o=u(2);return y(o.redirectToLogin())}),c(6,"Go to Login!"),a()()}}function Ge(i,r){if(i&1){let e=M();s(0,"div",7)(1,"h2"),c(2,"Activation failed!"),a(),s(3,"p"),c(4),a(),s(5,"button",6),f("click",function(){b(e);let o=u(2);return y(o.submitted=!1)}),c(6,"Try again"),a()()}if(i&2){let e=u(2);l(4),E(e.message)}}function Je(i,r){if(i&1&&(s(0,"div",3),h(1,Ze,7,0,"div",4)(2,Ge,7,1,"ng-template",null,1,te),a()),i&2){let e=ee(3),t=u();l(),d("ngIf",t.isOkay)("ngIfElse",e)}}function Ye(i,r){if(i&1){let e=M();s(0,"div",3)(1,"div",8)(2,"h2"),c(3,"Type your activation code:"),a(),s(4,"code-input",9),f("codeCompleted",function(o){b(e);let n=u();return y(n.onCodeCompleted(o))}),a()()()}i&2&&(l(4),d("isCodeHidden",!1)("codeLength",6)("code","number"))}var J=class i{constructor(r,e){this.router=r;this.authService=e}message="";isOkay=!0;submitted=!1;onCodeCompleted(r){this.confirmAccount(r)}redirectToLogin(){this.router.navigate(["login"])}confirmAccount(r){this.authService.activeAccount({token:r}).subscribe({next:()=>{A.fire({icon:"success",title:"Your account has been successfully activated",confirmButtonText:"Ok"}).then(()=>{this.submitted=!0,this.isOkay=!0})},error:()=>{A.fire({title:"Error!",text:"Token has been expired or invalid!",icon:"error",confirmButtonText:"Ok"}).then(()=>{this.submitted=!0,this.isOkay=!1})}})}static \u0275fac=function(e){return new(e||i)(m(H),m(I))};static \u0275cmp=v({type:i,selectors:[["app-activate-account"]],standalone:!0,features:[k],decls:3,vars:2,consts:[["codeForm",""],["activationError",""],["class","container",4,"ngIf","ngIfElse"],[1,"container"],["class","activate-message",4,"ngIf","ngIfElse"],[1,"activate-message"],[1,"btn","btn-primary",3,"click"],[1,"activate-error"],[1,"text-center",2,"width","400px"],[3,"codeCompleted","isCodeHidden","codeLength","code"]],template:function(e,t){if(e&1&&h(0,Je,4,2,"div",2)(1,Ye,5,3,"ng-template",null,0,te),e&2){let o=ee(2);d("ngIf",t.submitted)("ngIfElse",o)}},dependencies:[O,Le,He],styles:[".container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh}.activate-message[_ngcontent-%COMP%], .activate-error[_ngcontent-%COMP%]{text-align:center}.activate-error[_ngcontent-%COMP%]{color:red}"]})};var Ve=[{path:"login",component:Z},{path:"register",component:G},{path:"activate-account",component:J},{path:"books",loadChildren:()=>import("./chunk-CFW37L2M.mjs").then(i=>i.BookModule),canActivate:[Ee]}];var qe=(i,r)=>{if(i.url.includes("/auth/register"))return r(i);let t=pe($).token;if(t){let o=i.clone({setHeaders:{Authorization:`Bearer ${t}`}});return r(o)}return r(i)};var De={providers:[he({eventCoalescing:!0}),ke(Ve),Re(),be(Ae(),ye([qe]))]};var Xe={providers:[Se()]},Ne=Ce(De,Xe);var et=()=>xe(z,Ne),Ai=et;export{Ai as a};
